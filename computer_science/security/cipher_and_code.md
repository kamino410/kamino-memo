# 暗号技術のすべて読書メモ

## セキュリティの6要素

* OECD（経済協力開発機構）ガイドライン
  * 機密性（Confidentiality）
    * 意図した相手以外に情報が漏れないこと
  * 完全性（Integrity）
    * 届いた情報が正確であること（ノイズ・改竄に強いこと）
  * 可用性（Availability）
    * 必要な時点で利用できること（障害に強いこと）
* ISO/IEC TR13335ガイドライン
  * 上3つに加えて
  * 責任追跡性（Accountability）
    * ユーザーの行動・責任を追跡できること
  * 真正性（Authenticity）
    * ユーザー、システムによる振る舞いが明確であること（なりすましに強いこと）
  * 信頼性（Reliability）
    * システムやプロセスが矛盾なく動作すること、一貫して動作すること

## 用語

* 平文：もとの文章
* 暗号文：もとの文章を暗号化したもの
* 平文空間：平文に利用される符号の集まり
* 暗号空間：暗号文に利用される符号の集まり
* オラクル：要求に対してデータを返すもの

## コンピューター以前の暗号

* シーザー暗号（ROT3）
* コード
  * 事前に辞書（符牒）を作る
  * 第二次世界大戦時のアメリカ軍通信におけるナバホ語
* スキュタレー暗号
  * n飛び読み
* 転置式暗号
  * n文字のブロックに分割し中で並び替え
* 単一換字式暗号
  * 文字を1対1で置換
  * アルベルティの暗号円盤
  * 頻度分析
* 多表式暗号
  * トマス・ジェファーソンの暗号筒
    * 側面に26文字のアルファベットを刻んだ円盤を棒に差し込み、ある列を平文・別の列を暗号文にする
  * ヴィジュネル暗号
    * 26×26の表を用意し秘密鍵のk文字目と対応する位置の置換を表のk行目を用いて行う
    * カシスキー法
      * パターンから秘密鍵の文字数を推測する
    * 一致指数法
      * $$\mathrm{IC} = \frac{\sum_{i=0}^{25}F_i(F_i-1)}{N(N-1)}$$ の値から確率的に秘密鍵の文字数を推測する
    * スーパーインポジション
      * 同じ秘密鍵を利用した暗号文が複数あると同じ文字位置で同じ置換規則を使っていることが明らかなので頻度分析が可能になる
  * エニグマ暗号

## 共通鍵暗号

### 記述

* `k`：秘密鍵生成パラメーター
* `m`：平文
* `key`：秘密鍵
* `c`：暗号文
* `key = KeyGen(k)`：秘密鍵生成アルゴリズム
* `c = Enc(m, key)`：暗号化アルゴリズム
* `m' = Dec(c, key)`：復号アルゴリズム

### 攻撃モデル

1. 暗号文単独攻撃（Ciphertext Only Attack : COA）
    * `c*`のみから解読
2. 既知平文攻撃（Known Plaintext Attack : KPA）
    * 複数の`(m, c)`の組と解読対象`c*`から解読
3. 選択平文攻撃（Chosen Plaintext Attack : CPA）
    * 暗号化オラクルへのアクセスと解読対象`c*`から解読
4. 選択暗号文攻撃（Chosen Ciphertext Attack : CCA, CCA1）
    * 復号オラクルへのアクセス（ただし`c*`の取得前にのみアクセス可能）と解読対象`c*`から解読
5. 適応的選択暗号文攻撃（Adaptive Chosen Ciphertext Attack : CCA2）
    * 復号オラクルへのアクセスと解読対象`c*`から解読

----

* ブルートフォース攻撃
  * 鍵全数探索攻撃
    * `key`を総当りする方法
  * テーブル参照法
    * 事前に暗号化オラクルを入手して`(key, m, c)`の組を大量に計算しておき、そこからの検索で`key`を見つける方法
  * タイムメモリトレードオフ
    * 事前計算の結果から`key`の探索範囲を狭めて`key`を見つける方法
* ショートカット攻撃
  * アルゴリズムの特性を利用して`(m, c)`の組の集まりから`key`を見つける方法
* 識別攻撃
  * `m`が持つ何らかの法則を見破ること
  * 見破られたからといって即座に`m`から`key`を得ることが極端に簡単になったりはしないがヒントにはなるので、`m`とランダムビット列の識別不可能性はアルゴリズムの設計において重要視される

### 求められる性質

* 正当性
  * 暗号文を復号すると元の平文に戻ること
* 秘匿性
  * 暗号文から平文のヒントが一切得られないこと
  * ケルクホフスの原理
    * 秘密鍵以外がすべて漏れても秘匿性が保たれること
    * $$P(M=m\ |\ C=c) = P(M=m)$$
    * これを満たす暗号は平文より秘密鍵を短くすることはできない
* 識別不可能性
  * 秘匿性をより詳細にした概念
  * `key`がわからないとき`m`がランダムビット列と区別できないこと
  * 完全識別不可能性
    * 確率分布が完全に一致すること
  * 統計的識別不可能性
    * 確率分布がほぼ一致すること
  * 計算量的識別不可能性
    * 確率分布が違ってもアルゴリズムから見て区別できないこと

### バーナム暗号

ケルクホフスの原理を満たす完全な共通鍵暗号。

* `key`：ランダムなnビット列（`n`：平文の長さ）
* `Enc/Dec`：`key`との排他的論理和を取る

### ストリーム暗号

1ビット・1バイトなどの単位で暗号化を施す方法。

秘密鍵をシードに疑似乱数を生成したものを**鍵ストリーム**とし、鍵ストリームとの排他的論理和を取る処理で暗号化・復号する。
つまり、鍵ストリームを秘密鍵にするのではなく疑似乱数のシードを秘密鍵とすることでバーナム暗号を扱いやすくしたものと考えればよい。

### ブロック暗号

1ビット・1バイトよりも長いブロックと呼ばれる単位で暗号化を施す方法。
秘密鍵をシードに擬似乱数などで複数のサブキー（副鍵・拡大鍵・ラウンド鍵）を生成し、ブロックの暗号化に利用する。

平文がある程度の長さであればストリーム暗号より高速に動作する。
また後述のラウンド関数を正しく設計し秘密鍵を十分長くすれば平文・暗号文の組からサブキー・秘密鍵を特定するのは困難になるため、秘密鍵を固定してもそれが漏れない限りは安全といえる。
そのため、ICカード情報の暗号化（カードに秘密鍵を記録しておく）などに利用される。

#### Feistel構造

平文を左右に分割し、入れ替え・サブキーをシードとした処理（ラウンド関数）を複数回適用して暗号化する。

例

* DES
* Camellia
* MISTY1
* SEED

#### SPN構造

Substitution-Permutation Network。
平文をいくつかのブロックに分割し、それぞれにサブキーをシードとした処理を施し、最後にそれらを非線形変換（単なる置換ではなく、あるビットを変化させると別の位置のビットも影響を受ける）で結合することで暗号化する。

例

* AES

## ハッシュ関数

任意長の入力に対して固定長のハッシュ値を出力する関数。

### 求められる性質

* 高速な動作
* 一方向性（原像計算困難性）
  * あるハッシュ値が得られたとき、対応する入力を見つけるのが困難であること
* 第2原像計算困難性
  * ある入力・ハッシュ値の組が得られたとき、同じハッシュ値が得られる別の入力を見つけるのが困難であること
* 衝突困難性
  * 同じハッシュ値を持つような入力の組を1つ見つけるのが困難であること
* 近似衝突困難性
  * よく似たハッシュ値を持つ入力の組を効率的に特定できないこと
* 部分原像計算困難性
  * 一部が欠けたハッシュ値から欠けた部分を特定するのが困難であること

### 安全性

入力が $$q$$ パターン、出力が $$n$$ パターンのとき、アルゴリズムが最良の場合でも $$q-n$$ 組以上の衝突ペアが存在する（鳩の巣の原理）。

また、$$q<n$$ であったとしてもバースデーパラドックスの問題がある。
たとえば $$q = \sqrt{n}$$ のとき、衝突ペアが存在する確率は0.3以上、$$q = 1.18\sqrt{n}$$ のとき0.5以上になる。

これを考慮すると、各性質を破るために必要な平均計算回数は以下のようになる。

|性質|回数|
|----|----|
|一方向性|$$2^{n-1}$$ 回程度|
|第2原像計算困難性|$$2^{n-1}$$ 回程度|
|衝突困難性|$$2^{n/2}$$ 回程度|
