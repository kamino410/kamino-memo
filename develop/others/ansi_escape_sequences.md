# ANSIエスケープシーケンス（ANSI escape sequences）

**ANSIエスケープシーケンス**とはAmerican National Standards Instituteに規定されているターミナルの表示を細かく操作するための特殊コマンドの集まりを指す。

ターミナルによっては対応していないことも多い。
特にWindows周りはだめっぽい。
Cygwin+TeraTermなら一応動作するらしい。

## CSI（Control Sequence Introducer）

下記の形式で表現されるコマンド群をCSIと呼ぶ。

```
ESC[n1;n2;...
```

なお`ESC`はASCII文字の`27`,`0x1b`に相当する。

### 主なCSI

|コマンド|動作|
|----|----|
|`\x1b[` **`n`** `A`|上にnカーソル移動（省略すると1）|
|`\x1b[` **`n`** `B`|下にnカーソル移動（省略すると1）|
|`\x1b[` **`n`** `C`|右にnカーソル移動（省略すると1）|
|`\x1b[` **`n`** `D`|左にnカーソル移動（省略すると1）|
|`\x1b[` **`n`** `E`|n行下の行頭へカーソル移動（省略すると1）|
|`\x1b[` **`n`** `F`|n行上の行頭へカーソル移動（省略すると1）|
|`\x1b[` **`n`** `G`|左端からnの位置へカーソル移動（左端が1、省略すると1）|
|`\x1b[` **`n`** `;` **`m`** `H` or `f`|上からn、左端からmの位置へカーソル移動（上・左端が1、省略すると1）|
|`\x1b[` **`n`** `J`|画面消去 0:カーソルより後ろ 1:カーソルより前 2:全体（省略すると0）|
|`\x1b[` **`n`** `K`|行消去 0:カーソルより後ろ 1:カーソルより前 2:全体（省略すると0）|
|`\x1b[` **`n`** `S`|n行文次にスクロール（省略すると1）|
|`\x1b[` **`n`** `T`|n行文前にスクロール（省略すると1）|
|`\x1b[` **`n`** `m`|SGRパラメーターの設定（色を変えたり色々できる）|

### 主なSGRパラメーター

対応されてないことが多いものもちらほら。

|コマンド|動作|
|----|----|
|`\x1b[0m`|パラメーターリセット|
|`\x1b[1m`|太字指定|
|`\x1b[2m`|薄くする|
|`\x1b[3m`|イタリック|
|`\x1b[4m`|アンダーライン|
|`\x1b[5m`|点滅|
|`\x1b[6m`|高速点滅|
|`\x1b[7m`|色反転|
|`\x1b[8m`|隠し文字（コピペすると見える）|
|`\x1b[9m`|取り消し|
|`\x1b[30m`~`\x1b[37m`|色指定（黒 赤 緑 黄 青 マゼンタ シアン 白）|
|`\x1b[38m`|拡張色指定 カラーインデックス:`5;x` RGB:`1;r;g;b`|
|`\x1b[39m`|文字色リセット|
|`\x1b[40`~`\x1b[47`|背景色指定（黒 赤 緑 黄 青 マゼンタ シアン 白）|
|`\x1b[48m`|拡張背景色指定 カラーインデックス:`5;x` RGB:`1;r;g;b`|
|`\x1b[49m`|背景色リセット|

### 使用例

1行目に緑で「n%」2行目にプログレスバーを描画するプログラム。

```cpp
#include <iostream>
#define PROGSTEP 5

using namespace std;

int main (){
  cout << endl;
  for(int i = 0; i <= 100; i++){
    //前の描画を削除
    cout << "\r\x1b[2K\x1b[A\x1b[2K";
    //「n%」
    cout << "\x1b[32m" << i << "%\x1b[0m" << endl;
    //プログレスバー
    cout << "|";
    for(int j = 0; j <= i/PROGSTEP; j++)
      cout << "=";
    for(int j = i/PROGSTEP; j < 100/PROGSTEP; j++)
      cout << " ";
    cout << "|" << flush;

    for(int k = 0; k < 100000000; k++);
  }
  cout << endl;
}
```

```
14%
|===                  |
```
